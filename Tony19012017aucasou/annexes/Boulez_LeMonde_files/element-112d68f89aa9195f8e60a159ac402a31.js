/**
 * Package www/element
 * lmd/module/element/bootstrap
 * lmd/ui/iframe-fit-content
 * lmd/module/element/toolbar
 * lmd/ui/form/compteur-input
 * hgn/www/partials/element/toolbar.html.mu.js@abs
 * lmd/module/element/reaction
 * lmd/ui/lecture-zen
 * lmd/module/portfolio
 */

/* -- start module lmd/module/element/bootstrap -- */
define("lmd/module/element/bootstrap",function(require){var $=require("jquery");var toolbar=require("lmd/module/element/toolbar");var reaction=require("lmd/module/element/reaction");var facebook=require("lmd/core/social/facebook");var context=require("lmd/core/context");var tracking=require("lmd/module/element/tracking");var bootstrap={init:function(params){params.toolbar.context=context;toolbar.init(params.toolbar);tracking.attachXitiEvent(".js_article_body");$("figcaption[data-caption]").each(function(){var $copy=$(this).find("[data-copyright]");
$copy.text($copy.data("copyright"));$(this).html($(this).data("caption")+" "+$(this).html())});$("span#publisher").text($("span#publisher").data("source"));$(".illustration_haut").hover(function(){$("figcaption",this).stop(true,true).slideDown("fast")},function(){$("figcaption",this).stop(true,true).slideUp("fast")});if(typeof params.facebook==="undefined")params.facebook={};lmd.onload(function(){facebook.load().done(function(){facebook.parse(params.facebook)})})}};return bootstrap});

/* -- end module lmd/module/element/bootstrap -- */
/* -- start module lmd/ui/iframe-fit-content -- */
define("lmd/ui/iframe-fit-content",function(require){var $=require("jquery");var conf=require("lmd/core/conf");var iframeResizer=require("lib/iframe-resizer/iframeResizer");var scriptSrc=conf.medias.location.base_url_version+"/js/lib/iframe-resizer/js/iframeResizer.contentWindow.min.js";function resizeIframe(iframeToResize){$(iframeToResize).ready(function(){var currentIframeHeight=parseInt(iframeToResize.style.height||iframeToResize.height);var iframeBody=iframeToResize.contentWindow.document.body;var scriptElement=document.createElement("script");
scriptElement.src=scriptSrc;iframeBody.appendChild(scriptElement);if(isNaN(currentIframeHeight)||currentIframeHeight<100)iframeResizer({},iframeToResize)})}var iframeFitContent={init:function(iframeContainerId,iframeClass){var iframeContainer=document.getElementById(iframeContainerId);var iframes;if(iframeClass!==undefined){iframes=iframeContainer.getElementsByClassName(iframeClass);Array.prototype.forEach.call(iframes,function(iframe){resizeIframe(iframe)})}}};return iframeFitContent});

/* -- end module lmd/ui/iframe-fit-content -- */
/* -- start module lmd/module/element/toolbar -- */
define("lmd/module/element/toolbar",function(require){var $=require("jquery");var conf=require("lmd/core/conf");var context=require("lmd/core/context");var auth=require("lmd/core/auth");var facebook=require("lmd/core/social/facebook");var template=require("hoganpower!/partials/element/toolbar.html.mu");var objectPath=require("lib/object-path");var xiti=require("lmd/module/xiti/hit");var ignition=require("lmd/core/metrics/ignition-one");var sharing=require("lmd/ui/sharing");require("lib/jquery/plugin/jquery.spin");return{_renderDeferred:null,
$el:null,_options:null,render:function(){if(this._renderDeferred===null){this._renderDeferred=$.Deferred();auth.loadUser().done($.proxy(function(){sharing.getFacebookLikes().done($.proxy(function(facebookLikes){if(facebookLikes>0)facebookLikes=sharing.formatCounter(facebookLikes);else facebookLikes=false;var params={"facebook_likes":facebookLikes};if(this._options.aboLabel!==undefined)params.aboLabel=this._options.aboLabel;if(this._options.loginPartial!==undefined)params.loginPartial=this._options.loginPartial;
this.$el=$(template.render(params));this._initSharing();this._initEnvoyer();this._initImprimer();this._initClasser();this._initReagir();this._initAbonnezVous();this._renderDeferred.resolve()},this))},this))}return this._renderDeferred.promise()},_initSharing:function(partage){var self=this;var link;this.$el.find(".partage .facebook").click(function(event){link=partage||self._getPageUrl("",false);facebook.load().done(function(){FB.ui({method:"feed",link:link,picture:""})});self._xtSocial(event.currentTarget,
".partage .facebook","Facebook");ignition.triggerAction("partage")});this.$el.find(".partage .twitter").click(function(event){var baseUrl="http://twitter.com/share?related=lemondefr&lang=fr&text=";var text=$("<div />").html(self._options.context.item.titre).text();var sharedByLeMonde="";var url=baseUrl+encodeURIComponent(text);var params={width:550,height:443};if(!objectPath.get("context.item.partenaire"))sharedByLeMonde="&via=lemondefr";link=partage||self._getPageUrl("AL-32280258",true);url+=sharedByLeMonde+
"&url="+link;self._openPopupShare(url,params);self._xtSocial(event.currentTarget,".partage .twitter","Twitter");ignition.triggerAction("partage")})},_openPopupShare:function(url,params){var width=typeof params.width!=="undefined"?params.width:650;var height=typeof params.height!=="undefined"?params.height:430;var left=($(window).width()-width)/2;var top=($(window).height()-height)/2;var paramsOpen="";paramsOpen="width="+width+",height="+height+",top="+top+",left="+left;paramsOpen+=",location=no,resizable=yes,status=no,titlebar=no,toolbar=no";
window.open(url,"toolbar_share_popup",paramsOpen)},_xtSocial:function(elmt,selector,name){var titre=objectPath.get(this._options,"context.item.titre");if(!titre)return;var label="Partage::"+name+"::"+titre;var position=this._getPosition($(elmt).parents(".toolbar"));if(position)label+="::"+position;this._xtClick(elmt,false,label,"A")},_xtClick:function(elmt,displayPageXtn2,str,type){if(typeof type==="undefined")type="A";var xtn2=displayPageXtn2?this._options.context.page.xiti.xtn2:"";xiti.hit(elmt,
"C",xtn2,str,type);return false},_getPosition:function(toolbar){if(!$(".contenu_article").length)return;if($(toolbar).nextAll(".contenu_article").length>0)return"Top";else return"Bottom"},_initEnvoyer:function(){if(typeof this._options.envoyer==="undefined"||typeof this._options.envoyer.active!=="undefined"&&this._options.envoyer.active===false){this.$el.find(".outil_envoyer").hide();return}var self=this;this.$el.find(".outil_envoyer").on("click",function(event){self._xtClick(event.currentTarget,
true,"Clic_Envoyer");window.open(self._options.envoyer.link,"_blank")})},_initImprimer:function(){if(typeof this._options.imprimer==="undefined"||this._options.imprimer.active!==undefined&&this._options.imprimer.active===false||context.item!==undefined&&context.item.type!==undefined&&context.item.type.nom!==undefined&&(context.item.type.nom==="video"||context.item.type.nom==="portfolio")){this.$el.find(".outil_imprimer").hide();return}var self=this;this.$el.find(".outil_imprimer").click(function(event){self._xtClick(event.currentTarget,
true,"Clic_Imprimez");window.print()})},_initClasser:function(){if(typeof this._options.classer!=="undefined"&&typeof this._options.classer.active!=="undefined"&&this._options.classer.active===false){this.$el.find(".outil.classer").hide();return}if(auth.authenticated&&auth.user&&auth.user.abonne)this._checkFav();this.$el.find(".outil.classer").click($.proxy(this._onClickClasser,this));this.$el.find(".confirmation .fermer").click(function(){$(this).parents(".confirmation").hide()})},_onClickClasser:function(event){var toolbar=
$(event.currentTarget).parents(".toolbar");this._xtClick(event.currentTarget,true,"Clic_Classer");if(!auth.authenticated||!auth.user||!auth.user.abonne){if(toolbar.find(".teaser .non_abo.classer").is(":visible"))toolbar.find(".teaser").hide();else toolbar.find(".teaser").show();toolbar.find(".teaser .non_abo").hide();toolbar.find(".teaser .non_abo.classer").show();return}this._toggleFav(toolbar)},_checkFav:function(){var url="/api/1/user/classer/$1/$2/$3.html";var userId=auth.user.id+"";var data=
{};var jsonParams;url=url.replace("$1",userId[userId.length-1]);url=url.replace("$2",userId[userId.length-2]);url=url.replace("$3",userId);data.mode="has_elem";data.item_id=this._options.context.item.id;jsonParams="params="+JSON.stringify(data);$.get(url,jsonParams,null,"json").done(function(data){if(typeof data==="undefined"||data==="")return;if(data.result==="1")$(".toolbar .outil.classer").addClass("actif")})},_toggleFav:function(toolbar){toolbar.find(".confirmation").hide();this._callToggleFavApi();
var alltoolbar=$(".toolbar");var confirmationMessage;if(alltoolbar.find(".outil.classer").hasClass("actif")){alltoolbar.find(".outil.classer").removeClass("actif");confirmationMessage="Cet \u00e9l\u00e9ment a bien \u00e9t\u00e9 supprim\u00e9 de votre classeur."}else{alltoolbar.find(".outil.classer").addClass("actif");confirmationMessage="Cet \u00e9l\u00e9ment a bien \u00e9t\u00e9 ajout\u00e9 \u00e0 votre classeur."}toolbar.find(".confirmation .message").html(confirmationMessage).show();toolbar.find(".confirmation").show()},
_callToggleFavApi:function(){var data={};var jsonParams;data.mode="add_elem";data.item_id=this._options.context.item.id;jsonParams="params="+JSON.stringify(data);$.get("/api/1/user/classeur/",jsonParams,null,"json").done($.proxy(auth.refresh,auth))},_initReagir:function(){if(typeof this._options.reagir!=="undefined"&&typeof this._options.reagir.active!=="undefined"&&this._options.reagir.active===false){this.$el.find(".outil.reagir").hide();return}this.$el.find(".outil.reagir").on("click",$.proxy(this._onClickReagir,
this))},_onClickReagir:function(event){$(event.currentTarget).parents(".toolbar");this._xtClick(event.currentTarget,true,"Clic_Reagir");if(typeof this._options.reagir!=="undefined"&&typeof this._options.reagir.link!=="undefined")window.open(this._options.reagir.link,"_blank")},_initAbonnezVous:function(){if(typeof this._options.abonnez_vous!=="undefined"&&typeof this._options.abonnez_vous.active!=="undefined"&&this._options.abonnez_vous.active===false)return;if(!auth.authenticated||!auth.user||!auth.user.abonne){this.$el.find(".barre_outils .bt_abo").show();
var self=this;this.$el.find(".barre_outils .bt_abo, .teaser .btn_abo").click(function(event){self._xtClick(event.currentTarget,true,"Clic_Abonnement","N");window.open("http://"+conf.www.location.hostname+"/abo/?clef=BTN_OUTILS14","_blank")})}},_getPageUrl:function(xtor,urlencode){var hostname=conf.www.location.hostname;if(typeof this._options.sharing!=="undefined"&&typeof this._options.sharing.use_current_location!=="undefined"&&this._options.sharing.use_current_location===true)hostname=window.location.hostname;
var url="http://"+hostname+this._options.context.page.link;if(typeof xtor==="string"&&xtor!=="")url+="#xtor="+xtor;if(typeof urlencode==="boolean")if(urlencode===false)return url;return encodeURI(url)},parse:function(selector){selector=selector||"body";$(selector).find(".toolbar").unspin().append(this.$el).show()},_addSpin:function(){$(".toolbar").spin({height:30,width:534,spRadius:5,spWidth:2,spLength:3,spLines:12})},init:function(options){this._options=options;this.render().done($.proxy(this.parse,
this))}}});

/* -- end module lmd/module/element/toolbar -- */
/* -- start module lmd/ui/form/compteur-input -- */
define("lmd/ui/form/compteur-input",["jquery"],function($){return{init:function($textarea,$compteur){var limit=$textarea.attr("maxlength"),size=$textarea.val().length,left=limit-size;$textarea.keyup(function(){size=$(this).val().length;if(limit>0){left=limit-size>0?limit-size:0;$(this).val($(this).val().substring(0,limit))}var str_compteur=left;str_compteur+=left>1?" caract\u00e8res restants":" caract\u00e8re restant";$compteur.html(str_compteur)}).keyup()}}});

/* -- end module lmd/ui/form/compteur-input -- */
/* -- start module hgn/www/partials/element/toolbar.html.mu.js@abs -- */
define("hgn/www/partials/element/toolbar.html.mu.js@abs",function(){return function(c,p,i){var _=this;_.b(i=i||"");_.b("<div class=\"conteneur_barre_outils\">");_.b("\n" + i);_.b("   <div class=\"barre_outils\">");_.b("\n" + i);_.b("      <span class=\"bt_abo txt1\" style=\"display:none\">");_.b("\n" + i);_.b("         ");if(_.s(_.f("aboLabel",c,p,1),c,p,0,166,180,"{{ }}")){_.rs(c,p,function(c,p,_){_.b(_.t(_.f("aboLabel",c,p,0)));});c.pop();}_.b("\n" + i);_.b("         ");if(!_.s(_.f("aboLabel",c,p,1),c,p,1,0,0,"")){_.b("Abonnez vous<span class=\"toolbar-label\"> à partir de 1 &euro;</span>");};_.b("\n" + i);_.b("      </span>");_.b("\n" + i);_.b("      <a class=\"reagir outil\" href=\"#liste_reactions\"><span class=\"ico\"></span><span class=\"toolbar-label\"> Réagir</span></a>");_.b("\n" + i);_.b("      <span class=\"classer outil\"><span class=\"ico\"></span><span class=\"toolbar-label\"> Classer</span></span>");_.b("\n" + i);_.b("      <span class=\"outil_imprimer outil\" title=\"Imprimer\"><span class=\"imprimer ico\"></span></span>");_.b("\n" + i);_.b("      <span class=\"outil_envoyer outil\" title=\"Envoyer\"><span class=\"envoyer ico\"></span></span>");_.b("\n" + i);_.b("      <p class=\"partage\">");_.b("\n" + i);_.b("         <span class=\"outil_partage_facebook facebook outil\" title=\"Partager sur Facebook\"><span class=\"facebook ico\"></span><span class=\"toolbar-label\">Partager </span>");if(_.s(_.f("facebook_likes",c,p,1),c,p,0,959,979,"{{ }}")){_.rs(c,p,function(c,p,_){_.b("(");_.b(_.v(_.f("facebook_likes",c,p,0)));_.b(")");});c.pop();}_.b("</span>");_.b("\n" + i);_.b("         <span class=\"outil_partage_twitter twitter outil\" title=\"Partager sur Twitter\"><span class=\"twitter ico\"></span><span class=\"toolbar-label\">Tweeter</span></span>");_.b("\n" + i);_.b("      </p>");_.b("\n" + i);_.b("   </div>");_.b("\n" + i);_.b("   <p class=\"confirmation\" style=\"display:none\"><span class=\"message\"></span><span class=\"fermer\">fermer </span></p>");_.b("\n" + i);if(_.s(_.f("loginPartial",c,p,1),c,p,0,1335,1364,"{{ }}")){_.rs(c,p,function(c,p,_){_.b("      ");_.b(_.t(_.f("loginPartial",c,p,0)));_.b("\n");});c.pop();}if(!_.s(_.f("loginPartial",c,p,1),c,p,1,0,0,"")){_.b("      <div class=\"teaser clearfix reaction_identifier\" style=\"display:none\">");_.b("\n" + i);_.b("         <div class=\"non_abo classer\" style=\"display:none\">");_.b("\n" + i);_.b("            <span class=\"txt6 bold-title\">Classer</span>");_.b("\n" + i);_.b("            <p class=\"tt4_capital txt_classer clearfix\"><span class=\"agauche\">Pas le temps de<br>lire cet article ?</span><span class=\"bg\"></span></p>");_.b("\n" + i);_.b("            <p class=\"texte\">Conservez-le pour le consulter plus tard. Abonnez-vous au Monde.fr <strong><br/>&agrave; partir de 1 &euro;</strong>");_.b("\n" + i);_.b("            </p>");_.b("\n" + i);_.b("            <a onclick=\"return xt_click(this, 'C', lmd.context.page.xiti.xtn2, 'Clic_Abonnement','N');\" href=\"#\" class=\"btn_abo\">Abonnez-vous</a>");_.b("\n" + i);_.b("         </div>");_.b("\n" + i);_.b("         <div class=\"mini-login\">");_.b("\n" + i);_.b("            <div class=\"deja_abo txt3_120\">");_.b("\n" + i);_.b("               <div class=\"form\">");_.b("\n" + i);_.b("                  <span class=\"txt6 mgb16 clearfix bold-title\">Déjà abonné ?</span>");_.b("\n" + i);_.b("                  <p><a role=\"button\" id=\"btn_identification\" class=\"btn identifier js_trigger_login_register\" data-route=\"connexion\" href=\"https://");_.b(_.v(_.d("conf.wwws.location.hostname",c,p,0)));_.b("/account/?route=connexion\">S'identifier</a></p>");_.b("\n" + i);_.b("               </div>");_.b("\n" + i);_.b("            </div>");_.b("\n" + i);_.b("         </div>");_.b("\n" + i);_.b("      </div>");_.b("\n");};_.b("</div>");_.b("\n");return _.fl();;}})
/* -- end module hgn/www/partials/element/toolbar.html.mu.js@abs -- */
/* -- start module lmd/module/element/reaction -- */
define("lmd/module/element/reaction",function(require){require("lib/jquery/plugin/jquery.prettydate");require("lmd/core/context");var $=require("jquery"),auth=require("lmd/core/auth"),conf=require("lmd/core/conf"),compteurInput=require("lmd/ui/form/compteur-input");var reaction={_initDeferred:null,element_id:null,$root:null,$localForm:null,$globalForm:null,num_reaction:null,limit_reaction:3,signature:null,init:function(selector,elementId){var self=this;this.element_id=elementId;this.$root=$(selector||"this");$("[data-date-iso]",
self.$root).prettyDate({interval:3E4});if(this._initDeferred===null){this._initDeferred=$.Deferred();auth.loadUser().done(function(){if(auth.authenticated&&auth.user.abonne){$(".reaction_identifier",this.$root).remove();self.signature=auth.user.prenom+" "+auth.user.nom;self._getUserInfo().done(function(){self._initForm();self._initReagir();self._initRepondre();self._initDeferred.resolve()})}else{$(".reaction_redaction",this.$root).remove();self._initForm();self._initReagir();self._initRepondre();
self._initAbonnezVous();self._initDeferred.resolve()}})}return this._initDeferred.promise()},_getUserInfo:function(){var self=this;var userDef=$.Deferred();$.getJSON("/ws/1/reaction/information/",{item_id:this.element_id},"jsonp").done(function(response){if(response.error!==true)self.num_reaction=response.nb_user}).then(function(){userDef.resolve()});return userDef.promise()},_initForm:function(){if(this.num_reaction>=this.limit_reaction){this._hideReaction();return}if(this.$globalForm===null&&$(".reaction_identifier, .reaction_redaction",
this.$root).filter(":first").length>0){this.$globalForm=$(".reaction_identifier, .reaction_redaction",this.$root).filter(":first");this.$localForm=this.$globalForm.clone(true,true);this._initFormLogin();this._initFormReaction();this.$localForm.find("[name=reponse]").val(1)}$(".formReaction").css("display","block");$(".bt_repondre, .bt_repondre .btn",this.$root).css("visibility","auto");$(".bt_reagir").css("visibility","visible")},_initFormLogin:function(){var $form=this.$globalForm.add(this.$localForm);
$(".deja_abo",$form).on("submit",function(event){event.preventDefault();event.stopPropagation();var data=$(this).serialize(),form=this;auth.login(data,true).done(function(response){if(!response.result){$(".erreur",form).show();return}else auth.loadUser().done(function(){document.location.reload()})})});$(".password_recover",$form).on("click",function(event){event.preventDefault();event.stopPropagation();$(".trigger_boite_login").click();$("#password_recover").click()});$form.filter(".reaction_identifier").each(function(){})},
_hideReaction:function(){$(".reaction_identifier,.reaction_redaction",this.$root).remove();$(".bt_repondre, .bt_repondre .btn",this.$root).css("visibility","hidden");$(".bt_reagir",this.$root).css("visibility","hidden")},_initFormReaction:function(){var self=this,$form=this.$globalForm.add(this.$localForm);$(".infobulle",this.$root).removeClass("infobulle");$form.filter(".reaction_redaction").each(function(){compteurInput.init($("textarea",this),$(".annotation",this));var form=this;self.afficherNbRestant(this,
".num_reaction",self.num_reaction+1);$("[name=signature]").data("default",self.signature).val(self.signature);$(this).on("submit",function(event){event.preventDefault();event.stopPropagation();var data=$(this).serialize();$.post("/ws/1/reaction/valider/",data,"json").done($.proxy(function(response){if(response.error===true&&response.message.length>0){$(".erreur",this).html(response.message).show();return}$(".erreur",this).hide();$(".confirmation",this).show()},this))});$(".modifier, .annuler",form).off("click");
$(".modifier, .annuler",form).on("click",function(){var $input=$("[name=signature]",form);$(".modifier, .annuler, .alerte",form).toggle();if(typeof $input.attr("readonly")!=="undefined"){$input.removeAttr("readonly");$input.val("").focus()}else{$input.attr("readonly","readonly");$input.val($input.data("default"))}});$(".confirmation",this).off("click");$(".confirmation",form).on("click",".fermer",function(){$(this).closest(".confirmation").hide()});$(".regles_conduite",this).off("click");$(".regles_conduite",
this).on("click",function(){$("ul",this).slideToggle();$(".fle_ferme,.fle_ouvert",this).toggleClass("fle_ouvert fle_ferme")})})},_initReagir:function(){var self=this;$(".bt_reagir",this.$root).on("click",function(e){e.preventDefault();e.stopPropagation();self.$localForm.detach();$(window).scrollTop(self.$globalForm.offset().top-20)})},_initRepondre:function(){var self=this;$(".js_bt_repondre",this.$root).on("click",function(e){e.preventDefault();e.stopPropagation();if(this.$localForm!==null){var $item=
$(this).closest(".reaction");self.$localForm.insertAfter($item);self.$localForm.find("[name=element_id]").val($item.data("reaction_id"));self._initFormReaction()}})},_initAbonnezVous:function(){this.$root.find(".abo_link").on("click",function(event){event.preventDefault();event.stopPropagation();window.open("http://"+conf.www.location.hostname+"/abo/?clef=BT_REAGIRBAS14","_blank")})},afficherNbRestant:function(root,selector,nombre){var message,suffixe="e";if(nombre>3)nombre=3;if(nombre===1)suffixe=
"re";message=nombre+"<sup>"+suffixe+"</sup>";$(selector,root).html(message)}};return reaction});

/* -- end module lmd/module/element/reaction -- */
/* -- start module lmd/ui/lecture-zen -- */
define("lmd/ui/lecture-zen",function(require){var $=require("jquery");var Lightbox=require("lmd/ui/lightbox");var auth=require("lmd/core/auth");var toolbar=require("lmd/module/element/toolbar");var facebook=require("lmd/core/social/facebook");var objectPath=require("lib/object-path");var instance=null,config={id:null,el:".btn_lecture_zen",wrapper:".article_normal div#articleBody",elReaction:"p.reaction a, a.reagir.outil",listeReaction:".liste_reactions",topPos:75,bottomPos:25},myLightbox={overlay:".fond_overlay.lecture_zen",
wrapper:".overlay.lecture_zen",button:".fermer_lecture_zen",top:0,overlayClose:false,overlaySpeedIn:250,overlaySpeedout:250},ws="/ws/1/element/zen/",scrollTopPos=0,ScrollToReaction=false,singleton=function(){var LectureZen=function(){};LectureZen.prototype={init:function(params){var self=this;config=$.extend(config,params);if(config.id===undefined||config.envoyer===undefined||config.imprimer===undefined)throw new Error("Lecture zen : Attention, tous les param\u00e8tres doivent \u00eatre renseign\u00e9");
if(config.id===null)throw new Error("Lecture zen : Un id d\u2019item doit \u00eatre pass\u00e9 en param\u00e8tre lors de l\u2019initialisation");ws+=config.id+"/";self.create()},open:function(callback){var self=this;this.lightbox=new Lightbox(myLightbox);this.lightbox.setLoader(true);this.isOpen=true;$.getJSON(ws,null,"jsonp").done(function(data){self.lightbox.on("open",function(){self.fixSiblingsPositions(true);self.fixOverlayHeader(true);self.loadToolbar();self.triggerIgnitionOne();$(document).scrollTop(0);
require(["lmd/core/metrics/tradelab"],function(tradelab){tradelab.addScript("aboZen")});typeof callback==="function"&&callback()});self.lightbox.on("close",function(){self.close()});scrollTopPos=$(window).scrollTop();ScrollToReaction=false;self.lightbox.open(data.content);$(config.elReaction).on("click",function(e){e.preventDefault();ScrollToReaction=true;self.lightbox.close()})}).fail(function(){self.lightbox.close();self.isOpen=false})},close:function(){this.fixSiblingsPositions(false);this.fixOverlayHeader(false);
if(!ScrollToReaction)$(window).scrollTop(scrollTopPos);else $(window).scrollTop($(config.listeReaction).offset().top);this.isOpen=false},create:function(){var self=this;this.bouton=$("<div>").addClass(config.el.substr(1)).hide();var i;$.getJSON(ws,null,"jsonp");$(config.wrapper).append(this.bouton);this.bouton.fadeIn("fast");this.isHide=false;$(config.wrapper+" p").each(function(index){if($.trim($(this).html())!==""){i=index;return false}});if(i!=null)this.limitTop=$(config.wrapper+" p:eq("+i+")").offset().top;
this.limitBottom=this.limitTop+$(config.wrapper).height();this.isOpen=false;this.adjust();if(auth.authenticated)auth.loadUser().done(function(){if(auth.user.abonne===true)self.bouton.on("click",$.proxy(self.open,self))});$(window).on("scroll",$.proxy(this.adjust,this))},adjust:function(){var bouton=$(config.el),position=$(window).scrollTop(),left=$(config.wrapper).parent().offset().left-55;if(!this.isOpen)if(position<=this.limitBottom-config.bottomPos){if(this.isHide){bouton.fadeIn("fast");this.isHide=
false}if(position<=this.limitTop-config.topPos)bouton.css({top:this.limitTop-position,left:left});else bouton.css({top:config.topPos,left:left})}else{bouton.fadeOut("fast");this.isHide=true}},loadToolbar:function(){toolbar._options.envoyer=config.envoyer;toolbar._options.imprimer=config.imprimer;toolbar.$el=$(myLightbox.wrapper);toolbar._initSharing();toolbar._initEnvoyer();toolbar._initImprimer();toolbar._initClasser();toolbar._initReagir();facebook.load().done(function(){facebook.parse({})});if(window.twttr!==
undefined)twttr.widgets.load();$("article #publisher",$(myLightbox.wrapper)).text($("article #publisher").data("source"))},triggerIgnitionOne:function(){require(["lmd/core/metrics/ignition-one"],function(i){i.triggerAction("zen")})},fixSiblingsPositions:function(action){var fix=action||false,$header=$("header");if(fix)$header.css({"position":"fixed","width":"100%"});else $header.css({"position":"relative"})},fixOverlayHeader:function(action){var fix=action||false,$header=$(myLightbox.button);if(fix)$("body").append($header);
else $header.remove()}};return{getInstance:function(){if(instance===null)instance=new LectureZen;return instance},getConfig:function(){return config}}}();return singleton});

/* -- end module lmd/ui/lecture-zen -- */
/* -- start module lmd/module/portfolio -- */
define("lmd/module/portfolio",function(require){var $=require("jquery");var context=require("lmd/core/context");var op=require("lib/object-path");var sharing=require("lmd/ui/sharing");var swipe=require("lmd/util/swipe");var Carousel=require("lmd/ui/carousel");var INTERVAL=12E3;var Portfolio=function($element,carousel){var starter=$element.find(".js_start");this.$element=$element;this.$element.focus();this.$pauseplay=this.$element.find(".bt-lecture");this.carousel=carousel;this.isAtom=$element.attr("data-is-atom")!==undefined;
this.transitionEvents=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].join(" ");this.setInitialState();this.$element.addClass("disponible");this.$element.find(".js_start").text("D\u00e9marrer la lecture");if(this.isAtom||context.application==="mobile"||context.application==="mobileabo")this.start();else{this.$element.on("click.lmd.portfolio.start",".js_start",onStart.bind(this));this.$element.on("click.lmd.portfolio.fullscreen",".bt-plein-ecran",onFullScreen.bind(this))}this.$element.on("click.lmd.portfolio.slide",
".js-arrows [data-slide]",onSlide.bind(this));this.$element.on("click.lmd.portfolio.playpause",".js_controls",onPlayPause.bind(this));this.$element.on("lmd.carousel.slid",onSlid.bind(this));this.$element.on("keyup.lmd.portfolio",onKeyup.bind(this));this.$element.find("figure").each(function(index,figure){swipe(figure,function(event){event.x<0?carousel.previous():carousel.next()})})};Portfolio.KEYS={escape:27};Portfolio.prototype.hideCover=function(){this.$element.find(".infos-portfolio").addClass("invisible")};
Portfolio.prototype.showCover=function(){this.$element.find(".infos-portfolio").show().removeClass("invisible");this.$element.find(".compteur [data-carousel-item=currentIndex]").html(0)};Portfolio.prototype.loopToCover=function(){this.setInitialState();this.$element.removeClass("js-started");this.setState({current:0,returnedToCover:true});this.sync();this.$element.find(".slide.active").removeClass("active");this.carousel.$slides.eq(0).addClass("active");this.carousel.sync(this.$element.find(".slide.active"));
this.showCover()};Portfolio.prototype.setInitialState=function(state){return this.setState({playing:false,started:false,current:this.carousel.slideIndex(this.$element.find(".slide.active"))})};Portfolio.prototype.setState=function(state){var key;this.state=this.state||{};for(key in state)this.state[key]=state[key];this.carousel.sliding=!this.state.started;this.carousel.paused=!this.state.playing;this.carousel.options.interval=this.state.playing?INTERVAL:false};Portfolio.prototype.start=function(){var $active=
this.$element.find(".slide.active");if(!this.state.started)this.$element.find(".infos-portfolio").addClass("invisible").one(this.transitionEvents,function(){$(this).hide()});this.setState({started:true});this.$element.find(".compteur [data-carousel-item=currentIndex]").html(this.carousel.$slides.index($active)+1);this.$element.addClass("js-started");$(".contenu-portfolio-fullscreen .js-toolbar .js-button.bt-infos").addClass("actif");triggerXitiAction(this);callXtMed("C","","Portfolio::"+(this.state.current+
1),"A")};Portfolio.prototype.sync=function(){this.carousel.to(this.state.current);this.carousel.cycle(true);if(this.state.started)this.start();if(this.state.playing)this.$pauseplay.removeClass("play").addClass("pause");else this.$pauseplay.removeClass("pause").addClass("play")};function onKeyup(event){if((event.which===Carousel.KEYS.arrow_right||event.which===Carousel.KEYS.arrow_left)&&!this.state.started)if(this.state.returnedToCover)this.setState({returnedToCover:false});else if(event.which===Carousel.KEYS.arrow_right)this.start()}
function onStart(){callXtMed("C","","Portfolio::demarrer","A");this.start()}function onSlid(event,type){if(context.application!=="mobile"&&context.application!=="mobileabo"&&!this.isAtom)if(type==="next"&&this.state.current===this.carousel.$slides.length-1||type==="previous"&&this.state.current===0)return this.loopToCover();this.setState({current:this.carousel.slideIndex(this.$element.find(".slide.active"))});triggerXitiAction(this)}function triggerXitiAction(portfolio){var xtpage="";var index=0;
if(op.has(context,"page.xiti.xtpage")&&op.has(context,"page.xiti.xtn2")){index=portfolio.carousel.slideIndex(portfolio.$element.find(".slide.active"))+1;xtpage=context.page.xiti.xtpage.replace(/(?=[^\:]*$).*/,"portfolio-"+index+"&x2=portfolio");callXtMed("F",context.page.xiti.xtn2,xtpage)}}function onSlide(event){callXtMed("C","","Portfolio::"+(this.state.current+1),"A");callXtMed("C","","Portfolio::"+$(event.target).data("slide"),"A");if(!this.isAtom&&lmd.advertController)lmd.advertController.refresh("pave_haut",
lmd.context.page.advert.smart.page)}function onFullScreen(){var template=require("hoganpower!/partials/element/portfolio/content-fullscreen.html.mu@www");var carousel=null;var portfolio=null;var data=this.$element.data("lmd.portfolio.fullscreen")||{};data.state=this.state;callXtMed("C","","Portfolio::plein_ecran","A");carousel=new Carousel($(template.render(data)),this.carousel.options);carousel.$element.data("lmd.carousel",carousel);portfolio=new Portfolio(carousel.$element,carousel);portfolio.setState(this.state);
portfolio.sync();if(portfolio.state.started)portfolio.$element.find(".js-toolbar .js-button.bt-infos").addClass("actif");else portfolio.$element.find(".js-toolbar .js-button.bt-infos").removeClass("actif");$("body").addClass("portfolio-plein-ecran").append(portfolio.$element);portfolio.$element.focus();portfolio.$element.on("click.lmd.fullscreen",".js-close",onFullScreenClose.bind(null,portfolio,this));portfolio.$element.on("keydown.lmd.fullscreen",function(event){if(event.which===Portfolio.KEYS.escape){onFullScreenClose(portfolio,
this);event.preventDefault()}}.bind(this));portfolio.$element.on("click.lmd.fullscreen",".js-toolbar .js-button",function onToolbarButtonClick(){$(".js-toolbar .js-button").removeClass("actif");$(this).addClass("actif");$("#panneau-lateral .js-panel").addClass("inactif");$("#panneau-lateral").removeClass("inactif");$(".js-hide").removeClass("actif");$("#"+$(this).data("target")).removeClass("inactif")}).on("click.lmd.fullscreen",".js-toolbar .js-hide",function onToolbarButtonClick(){$(".js-toolbar .js-button").removeClass("actif");
$(this).addClass("actif");$("#panneau-lateral").addClass("inactif")});sharing.init(".contenu-portfolio-fullscreen");this.setState({playing:false})}function onFullScreenClose(fullscreen,portfolio){$("body").removeClass("portfolio-plein-ecran");portfolio.setState(fullscreen.state);portfolio.sync();portfolio.carousel.$slides.eq(portfolio.state.current).addClass("active");portfolio.carousel.to(portfolio.state.current);portfolio.$element.focus();fullscreen.$element.remove();if(portfolio.state.started)portfolio.hideCover();
else portfolio.loopToCover()}function onPlayPause(){if(!this.state.started)this.start();this.setState({playing:!this.state.playing});this.$pauseplay.toggleClass("pause play");this.carousel.cycle(true);callXtMed("C","","Portfolio::"+(!this.state.playing?"pause":"play"),"A")}function callXtMed(){if(typeof window.xt_med==="function")window.xt_med.apply(null,arguments)}function plug(){var instance=this.data("lmd.portfolio");if(!instance)if(this.data("lmd.carousel.ready"))this.data("lmd.portfolio",instance=
new Portfolio(this,this.data("lmd.carousel")));else this.one("carousel.ready",function(event,carousel){this.data("lmd.portfolio",instance=new Portfolio(this,carousel))}.bind(this))}$(window).on("load",function(){$('[data-ui="carousel"][data-module="portfolio"]').each(function(){plug.call($(this))})})});

/* -- end module lmd/module/portfolio -- */