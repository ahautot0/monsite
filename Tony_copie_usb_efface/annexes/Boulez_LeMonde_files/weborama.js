define(function(require){var $=require("jquery");var objectPath=require("lib/object-path");var auth=require("lmd/core/auth");var conf=require("lmd/core/conf");var context=require("lmd/core/context");var storage=require("lmd/core/storage");function injectIframe(url){var $container=$("body");var $iframe=$("<iframe>",{src:url,width:0,height:0,frameborder:0}).hide();$container.append($iframe)}function injectWamScript(){var configuration=getConfiguration();var wsc=document.createElement("script");wsc.type=
"text/javascript";wsc.onload=function(){wamf.account("2446");$.each(configuration,function(index,value){wamf.push(index,value)});wamf.send()};wsc.src=("https:"===document.location.protocol?"https://":"http://")+"wamfactory.solution.weborama.fr/static/wamfactory.wildcard.min.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(wsc,s)}function getConfiguration(){var configuration={site:"Lemonde",cat1:objectPath.get(context,"rubrique.url_friendly")||"",contenu:context.pageType||
"",motclef:"",device:getCurrentDevice(),id_crm:objectPath.get(storage.get("lmd_crm_data",false),"browserId")||0,user_id:objectPath.get(storage.get("user",false),"id")||0,user_statut:lmd.auth_sync.abonne?"abonne":"anonyme",user_gender:"",user_age:"",user_postalcode:""};addConfigurationCategories(configuration);return configuration}function addConfigurationCategories(configuration){var categories=Array.prototype.slice.call(lmd.context.rubriques||lmd.context.rubrique||[]);categories.reverse();$.each(categories,
function(index,category){var varName="cat"+(index+1);configuration[varName]=category.url_friendly})}function getCurrentDevice(){var breakpoints={mobile:320,tablet:768,desktop:1E3};var breakpoint=false;for(var key in breakpoints)if(breakpoints[key]<document.documentElement.clientWidth)breakpoint=key;return breakpoint}if(conf.fsw.weborama)(function(lmd){lmd.onload(function(){injectIframe("//cstatic.weborama.fr/iframe/customers/premium.html?idEditeur=1173&idSite=257");injectWamScript();injectIframe("//cstatic.weborama.fr/iframe/aud_trans/external_LM.html")})})(window.lmd)});
