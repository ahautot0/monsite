define(function(require){var auth=require("lmd/core/auth");var objectPath=require("lib/object-path");var _paq=_paq||[],_u="http://api.ownpage.fr/v1/taginput/",_trackingKey="9dcde00af7a7ee76a",whitelistUsers=["abonne"];return{init:function(){if(!isValidPage())return false;auth.loadUser().done(function(){if(auth.checkAuthentication()&&whitelistUsers.indexOf(auth.user.type)!==-1){_paq.push(["setSiteId",_trackingKey]);_paq.push(["setTrackerUrl",_u]);_paq.push(["setCustomVariable",1,"userId",auth.user.id,
"page"]);_paq.push(["trackPageView"]);_paq.push(["enableLinkTracking"]);window._paq=_paq;require([_u+"optag.js"])}})}};function isValidPage(){var application=objectPath.get(lmd,"context.application");var whitelistPages=["article","portfolio","video"];switch(application){case "abonnes":case "www":var elementType=objectPath.get(lmd,"context.element.type.nom");return whitelistPages.indexOf(elementType)>-1;break;case "blog":return objectPath.get(lmd,"context.pageType")==="Element"&&objectPath.get(lmd,
"context.blogType")==="Invit\u00e9";break}return false}});
